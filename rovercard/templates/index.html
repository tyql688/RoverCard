<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rover Card</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 2.5em;
      }
      .upload-area {
        border: 3px dashed #667eea;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .upload-area:hover {
        border-color: #764ba2;
        background-color: #f8f9ff;
      }
      .upload-area.dragover {
        border-color: #764ba2;
        background-color: #f0f2ff;
      }
      input[type="file"] {
        display: none;
      }
      .upload-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        transition: transform 0.2s;
      }
      .upload-btn:hover {
        transform: translateY(-2px);
      }
      .preview-area {
        display: flex;
        justify-content: space-around;
        margin-top: 30px;
        gap: 20px;
      }
      .preview-box {
        text-align: center;
        flex: 1;
      }
      .preview-box h3 {
        color: #333;
        margin-bottom: 15px;
      }
      .preview-box img {
        max-width: 100%;
        max-height: 300px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .loading {
        display: none;
        text-align: center;
        margin: 20px 0;
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .status-message {
        text-align: center;
        margin: 20px 0;
        padding: 10px;
        border-radius: 5px;
        display: none;
      }
      .status-message.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status-message.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ´ Rover Card</h1>

      <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <p>ğŸ“ ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>
        <p style="color: #666; font-size: 14px">æ”¯æŒ PNG, JPG, JPEG, WEBP æ ¼å¼ï¼Œé€‰æ‹©åå°†è‡ªåŠ¨å¤„ç†</p>
        <input type="file" id="fileInput" accept="image/*" />
        <button class="upload-btn">é€‰æ‹©å›¾ç‰‡</button>
      </div>

      <div class="status-message" id="statusMessage"></div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>æ­£åœ¨å¤„ç†å›¾ç‰‡...</p>
      </div>

      <div class="preview-area" id="previewArea" style="display: none">
        <div class="preview-box">
          <h3>ğŸ“· åŸå§‹å›¾ç‰‡</h3>
          <img id="originalImage" alt="åŸå§‹å›¾ç‰‡" />
        </div>
        <div class="preview-box">
          <h3>âœ¨ å¤„ç†åå›¾ç‰‡</h3>
          <img id="processedImage" alt="å¤„ç†åå›¾ç‰‡" />
        </div>
      </div>
    </div>

    <script>
      let selectedFile = null;

      // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
      function showMessage(message, type = "success") {
        const statusMessage = document.getElementById("statusMessage");
        statusMessage.textContent = message;
        statusMessage.className = `status-message ${type}`;
        statusMessage.style.display = "block";

        // 3ç§’åè‡ªåŠ¨éšè—
        setTimeout(() => {
          statusMessage.style.display = "none";
        }, 3000);
      }

      // æ–‡ä»¶é€‰æ‹©å¤„ç†
      document.getElementById("fileInput").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
          handleFileSelect(file);
        }
      });

      // æ‹–æ‹½å¤„ç†
      const uploadArea = document.querySelector(".upload-area");

      uploadArea.addEventListener("dragover", function (e) {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });

      uploadArea.addEventListener("dragleave", function (e) {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
      });

      uploadArea.addEventListener("drop", function (e) {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          handleFileSelect(file);
        }
      });

      function handleFileSelect(file) {
        selectedFile = file;

        // æ˜¾ç¤ºåŸå§‹å›¾ç‰‡é¢„è§ˆ
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById("originalImage").src = e.target.result;
          document.getElementById("previewArea").style.display = "flex";

          // è‡ªåŠ¨å¼€å§‹å¤„ç†å›¾ç‰‡
          processImage();
        };
        reader.readAsDataURL(file);
      }

      async function processImage() {
        if (!selectedFile) return;

        const loading = document.getElementById("loading");

        loading.style.display = "block";
        showMessage("å¼€å§‹å¤„ç†å›¾ç‰‡...", "success");

        try {
          const formData = new FormData();
          formData.append("image", selectedFile);

          const response = await fetch("/rover-card/", {
            method: "POST",
            body: formData,
          });

          if (response.ok) {
            const blob = await response.blob();
            const imageUrl = URL.createObjectURL(blob);
            document.getElementById("processedImage").src = imageUrl;
            showMessage("å›¾ç‰‡å¤„ç†å®Œæˆï¼", "success");
          } else {
            const errorText = await response.text();
            showMessage(`å›¾ç‰‡å¤„ç†å¤±è´¥: ${errorText}`, "error");
          }
        } catch (error) {
          console.error("Error:", error);
          showMessage("å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯", "error");
        } finally {
          loading.style.display = "none";
        }
      }
    </script>
  </body>
</html>
